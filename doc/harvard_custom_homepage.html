<!DOCTYPE html>
    <style>
        /* Custom CSS for the custom homepage... */
        .lite-header {font-weight: 300;}

        div.hmpg-action-block {padding-top:2em;}
        div.search-widget {padding-bottom: 2em;}
        div.browse-subjects a {color: #C55B28;}
        div.browse-subjects a:focus, div.browse-subjects a:hover {color: #9F3502;}
        div.hmpg-recent-col div.hmpg-recent-thumb img {max-height:48px;max-width:48px;}
        div.hmpg-recent-col div.hmpg-recent-thumb span {font-size:38px;}
        div.hmpg-activity-block .row .lite-header {margin-left:1em;}

        .btn-harvard { 
          color: #A51C30;
          background: #FFFFFF;
          font-weight: bold;
        }
        .btn-harvard:hover, 
        .btn-harvard:focus, 
        .btn-harvard:active, 
        .btn-harvard.active, 
        .open .dropdown-toggle.btn-harvard { 
          color: #7F000A;
          background: #FFFFFF;
          font-weight: bold;
        } 
    </style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script>
    var baseUrl = "http://localhost:8080";
    //var baseUrl = "https://dataverse.harvard.edu"
    
    //This get slow and eventually the resulting pile of substrings is too long if there are actually 1000 results
    //For this search to be valid the results returned will need to be higher than 1000 even
    var firstSearch = baseUrl + "/api/search?q=*&type=dataverse&per_page=1000";
    var secondSearch = baseUrl + "/api/search?q=*&type=dataset&sort=date&order=desc&per_page=";
    var thumbBaseURL = baseUrl + "/api/datasets/:persistentId/thumbnail" + "?persistentId=";
    var metricBaseUrl = baseUrl + "/api/info/metrics/";
    
    function queryAndWrite(fqString, resultCount, elm) {
        var tempSecondSearch = secondSearch + resultCount;
        
        $.get(firstSearch + fqString, function(jData) {
            jData.data.items.forEach(function(item){
                tempSecondSearch += "&subtree=" + item.identifier;
            });

            $.get(tempSecondSearch, function(jData2) {
                var resultHtml = "";
                jData2.data.items.forEach(function(item){
                    resultHtml += "<div class=\"col-xs-2 text-center hmpg-recent-thumb\"><a href=\"/dataset.xhtml?persistentId=" + item.global_id + "\" title=\"" + item.name + "\"><img src=\"" + thumbBaseURL + item.global_id + "\" alt=\"Dataset thumbnail\"></a></div>";
                    resultHtml += "<div class=\"col-xs-10\"><p><a href=\"/dataset.xhtml?persistentId=" + item.global_id + "\" title=\"" + item.name + "\">" + item.name + "</a></p></div>";
                    resultHtml += "<hr class=\"col-xs-11 no-margin-top\"/>"
                });
                document.getElementById(elm).innerHTML = resultHtml;
            });
        });
    }
    
    function queryMetric(metricRelPath, month, elm) {
        // $.get(metricBaseUrl + metricRelPath + month, function(jData) {
        //     document.getElementById(elm).innerHTML = JSON.stringify(jData);
        // });

        $.get(metricBaseUrl + metricRelPath + month, function(jData) {

            var resultCount = jData.data.count; //"6"

            document.getElementById(elm).innerHTML = resultCount;
        });
    }
 
    function querySubject(metricRelPath, resultCount, elm) {
        $.get(metricBaseUrl + metricRelPath, function(jData) {
            document.getElementById(elm).innerHTML = JSON.stringify(jData);
        });
    }

    //These are the correct searches, but commented out as I don't have enough results
    //queryAndWrite("&fq=dvCategory:(Journal%20OR%20Laboratory)",3, "journals");
    //queryAndWrite("&fq=dvCategory:(\"Research+Project\"%20OR%20Researcher)",6, "researchers");
    
    queryAndWrite("" , 3, "journals");
    queryAndWrite("" , 6, "researchers");
    
    queryMetric("datasets/toMonth", "", "activityAllTimeDatasetsValue");
    queryMetric("files/toMonth", "", "activityAllTimeFilesValue");
    
    //These don't actually return the past 30 days, just the value up until September. Will need discussion
    queryMetric("datasets/toMonth", "/2018-09", "activity30DaysDatasetsValue");
    queryMetric("files/toMonth", "/2018-09", "activity30DaysFilesValue");
    
    querySubject("dataverses/bySubject", "", "dataversesBySubject");
</script>

<html>
    <body>

        <div id="dataversesBySubjectHead"><b>Dataverses By Subject</b></div>
        <div id="dataversesBySubject"></div>
        <hr>

    <!-- SEARCH + BROWSE + RECENT -->
    <div class="row hmpg-browse-block">


        <div class="col-xs-12">
            <div class="row">
                <div class="col-xs-4">
                    <div class="h4 lite-header margin-bottom">Datasets from journal articles</div>
                </div>
                <div class="col-xs-8">
                    <div class="h4 lite-header margin-bottom">Datasets from research projects, groups and researchers</div>
                </div>
            </div>
            

            <div class="row">
                <div class="col-xs-4 hmpg-recent-col">
                    <hr class="col-xs-11 no-margin-top"/>

                    <!-- JOURNAL RESULTS -->
                    <div id="journals"></div>

                    <!-- VIEW ALL -->
                    <div class="col-xs-11 text-center">
                        <p class="small text-muted"><a href="#" title="{TITLE}">TODO ALL RECENT JOURNAL ACTIVITY</a> <span class="glyphicon glyphicon-chevron-right"></span></p>
                    </div>
                </div>

                <div class="col-xs-4 hmpg-recent-col">
                    <hr class="col-xs-11 no-margin-top"/>

                    <!-- RESEARCHERS RESULTS -->
                    <div id="researchers"></div>

                    <!-- VIEW ALL -->
                    <div class="col-xs-11 text-center">
                        <p class="small text-muted"><a href="#" title="{TITLE}">TODO ALL RECENT RESEARCHERS ACTIVITY</a> <span class="glyphicon glyphicon-chevron-right"></span></p>
                    </div>
                </div>

                <div class="col-xs-4 hmpg-recent-col">
                    <hr class="col-xs-11 no-margin-top"/>

                    <!-- RESULT 1 -->
                    <div class="col-xs-2 text-center hmpg-recent-thumb">
                        <a href="/dataset.xhtml?persistentId=doi:10.7910/DVN/P0OMNM" title="{TITLE}"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAwCAYAAACMuVOlAAAEN0lEQVR42s2ZX0gUQRzHz0DpQSGELiGKKAkfDIKKzCQokTwJK3zIhEhQiQsuohTSUvyTKKYiZKb2TywI7Q9R2D98OjDSLrA/6ItZCoU+nGkUEdRN9x33N81te+fV7d24MMzuzO3sZ3//Z89i8T2YJbgj2N+Zf5Sda2XBAJTUNqqDxMM10IBSrGq6qA6y5vwllrxxw0LSZCfKz6qDLG/pZHXt3SyQOjG3as1qpswuDx0/zdWddbDALwTm62pLmVUVpC0nl0N63INcov5MAvPKJJmYvIlxiDkX7w1AxEuoDEOMJDXqvMyy9mUzvc2iYX75igR1kAgvkKTn6xufcAQbBODe/MN8Pm3nDsWQXkCAQP3kII7qFg75bvghn8uw2dRBcpvTIOfG+oTtAZ7sFfNaPFUH6Z4YEKBNXT2Mxrk9YtzblDvOkPPWvMS8DXAEiPi4KCARH9ubq4UkAUg5nVQ96epVlxZJrXAKkhhJsdBuF+D+An1EDqsGGRtv5UC/Zl5x9QNS2KliVXNIyjSk2orWLh+PVypFWZIFjpNCarHL4vgYpJqRmqQWkA7EQ3ISSBSVEerHtoYSdZWPUU0Jb0Z+pu2E0vrRn8oBWVSQx+0P0Bqgvqk9kGUclQ1ckqgxk7ft4uBwKphD8anSxQFK8fFoGd/PCC8H6IUrN1i/8xnzeDxqQSE52vOkpmdyIDQaA6z7y7f5cKXNadCRczCSJAVzGQSQMAkRU7VxQEdUurBJwBEsKnGCcb0e4ZAwATSMwW5laUY0j6MBhKRKksMYlXG4vnPvroB8OexiEXeelWvXs/GJ9z4q1zceW7VzvU3SONYIS2DXw6Ail1TK2rt7+HVbRwfva+vrjUD0zmWuygeeD7KxyU8+D6mKiWIO75xDevjM7OeFAMIDSYuiyED/6EGvgKNGD38x8oFLM5j1TE2PurcX5wT3s+YA70miC63Z9/iJ6d4voJBh9Lb5oyKffT+zn4MGCynfPzo2wUyR5Mep6YAefbX7Gnt7dDfrvHl/wSxjlV4a4YoCP+zdFIniAUtj4/m2Aj3GEpN4AczH4DT/YuP6DNXX7/wrrZpiFshIWORIcanIQoinge6pLK8x1MjmlBQOjPAlj5PDhhTkKSPJCwf6nK13wGDbf++DqGyj6l1eNMDnarYlLd1HtbL0pt1zrLkxLnQb3W7L8cnndG6kQv29efZiuQYIfz6nh9G1LM3xqVlDSFT1Qf7DEXo+JzAYNl2jxjQqOoxeMNx/sQh7lFVOvVGVjhehewlQ+234dpKQGH2rxDntfUj9emlibN2S+Y+z1OA811Msom1NiDIlVYrSjB5EkOhpi4GdpT7M0G9pp0nR4Hb2nxbSNjkzMYoNHYthT4uieU+QMqBso2SbyEoESf9oZOzJEdkKkjVVxdqCDMBJ1mghFQJF0zx58XzhQJzMLbRHFOo3uJqAWXt2qn4AAAAASUVORK5CYII=" alt="Dataset thumbnail"></a>
                    </div>
                    <div class="col-xs-10">
                        <p><a href="#" title="{TITLE}">TODO Short Title</a><br/><span class="text-muted small"><a href="#" title="" class="highlightBold">Dataverse Name</a> - Publish Date</span></p>
                    </div>
                    <hr class="col-xs-11 no-margin-top"/>

                    <!-- RESULT 2 -->
                    <div class="col-xs-2 text-center hmpg-recent-thumb">
                        <a href="/dataset.xhtml?persistentId=doi:10.7910/DVN/P0OMNM" title="{TITLE}"><span class="icon-dataset"></span></a>
                    </div>
                    <div class="col-xs-10">
                        <p><a href="#" title="{TITLE}">TODO Replication Data For: Long Dataset Title, Whatever the Median Dataset Title Length Is Currently in Production, I Should Probably Look That Up</a><br/><span class="text-muted small"><a href="#" title="" class="highlightBold">Dataverse Name</a> - Publish Date</span></p>
                    </div>
                    <hr class="col-xs-11 no-margin-top"/>

                    <!-- RESULT 3 -->
                    <div class="col-xs-2 text-center hmpg-recent-thumb">
                        <a href="/dataset.xhtml?persistentId=doi:10.7910/DVN/P0OMNM" title="{TITLE}"><span class="icon-dataset"></span></a>
                    </div>
                    <div class="col-xs-10">
                        <p><a href="#" title="{TITLE}">TODO Replication Data For: Long Dataset Title, Whatever the Median Dataset Title Length Is Currently in Production, I Should Probably Look That Up</a><br/><span class="text-muted small"><a href="#" title="" class="highlightBold">Dataverse Name</a> - Publish Date</span></p>
                    </div>
                    <hr class="col-xs-11 no-margin-top"/>
                </div>
            </div>
        </div>
    </div>

    <hr/>

    <!-- ACTIVITY -->
    <div class="row hmpg-activity-block">
        <div class="col-xs-12">
            <div class="h4 lite-header margin-bottom">Activity</div>
        </div>
        <div class="col-xs-12 row">
            <div class="col-xs-6">
                <p><span class="highlightBold">All Files</span> <span class="h4 lite-header" id="activityAllTimeDatasetsValue"></span> datasets added <span class="h4 lite-header" id="activityAllTimeFilesValue"></span> file downloads</p>
            </div>
            <div class="col-xs-6">
                <p><span class="highlightBold">Past 30 Days</span> <span class="h4 lite-header" id="activity30DaysDatasetsValue"></span> datasets added <span class="h4 lite-header" id="activity30DaysFilesValue"></span> file downloads</p>
            </div>
        </div>
    </div>

    <hr/>


    </body>
</html>