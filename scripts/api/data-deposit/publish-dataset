#!/bin/sh
USERNAME=pete
PASSWORD=pete
DVN_SERVER=localhost:8181
if [ -z "$1" ]; then
  GLOBAL_ID=`scripts/api/data-deposit/list-datasets | xpath '//id/text()' | cut -d'/' -f11,12`
else
  GLOBAL_ID=$1
  #GLOBAL_ID=doi:myAuthority/17
  #GLOBAL_ID=doi:10.5072/FK2/5555
fi
# when contentLength is zero headersOnly is true, which is what we want: https://github.com/swordapp/JavaServer2.0/blob/31e625ac97be13f794e1b98512f8d1c48d751652/src/main/java/org/swordapp/server/ContainerAPI.java#L338
TMPFILE="zero-length-file-`uuidgen`.txt"
touch $TMPFILE
#curl --insecure -s -X POST -H "In-Progress: false" --upload-file $TMPFILE -u sword:sword $EDIT_URI \
#    | xmllint --format -
curl -s --insecure -X POST -H "In-Progress: false" --upload-file $TMPFILE https://$USERNAME:$PASSWORD@$DVN_SERVER/dvn/api/data-deposit/v1/swordv2/edit/study/$GLOBAL_ID \
| xmllint --format -
rm $TMPFILE
