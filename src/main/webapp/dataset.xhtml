<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Dataverse</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta http-equiv="Content-Language" content="en"/>
        <style type="text/css">
            .panelgridHeaderTable {width:100%;}
            .panelgridHeaderTable .ui-widget-content, .panelgridHeaderTable .ui-widget-content > td {border:0; background:none;}
            .panelgridHeaderTable .ui-widget-content > td:last-child table {margin-left:auto;}

            .panelLayoutBlock, .panelLayoutTitleBlock, .panelLayoutButtonBlock {border:0;}
            .panelLayoutBlock .ui-panelgrid.panelgridLayoutTable .ui-widget-content, .panelLayoutBlock .ui-panelgrid.panelgridLayoutTable .ui-widget-content > td {border:0;}

            .panelgridLayoutTable, .panelgridFormTable {width:100%;}
            .panelgridFormTable > tbody > tr.ui-widget-content > td:first-child {width:20%;}

            .panelLayoutButtonBlock button {margin-right:2em;}

            .panelLayoutBlock > .ui-widget-content {border-bottom:1px solid #DDDDDD;}
            .panelLayoutBlock.breadcrumbNavBlock > .ui-widget-content {border-bottom:0;}
            .panelLayoutTitleBlock > .ui-widget-content {border:0;}

            .panelLayoutBlock .ui-panelgrid.panelgridLayoutTable .ui-widget-content .ui-panelgrid {margin-bottom: 1em;}
            .panelLayoutBlock .ui-panelgrid.panelgridLayoutTable .ui-widget-content .ui-panelgrid .ui-widget-content .ui-panelgrid {margin-bottom: 0}
            .panelLayoutBlock .ui-panelgrid.panelgridLayoutTable .ui-widget-content .ui-panelgrid .ui-widget-content .ui-panelgrid td:first-child {padding-left:0;}

            .rightClass {text-align: right;}
        </style>
    </h:head>

    <h:body>
        <f:metadata>
            <f:viewParam name="id" value="#{DatasetPage.dataset.id}"/>
            <f:viewParam name="ownerId" value="#{DatasetPage.ownerId}"/>
            <f:viewAction action="#{DatasetPage.init}" />
        </f:metadata>

        <!-- Header Panel -->
        <p:panel style="background-color: lightskyblue; height:70px;">
            <p:panelGrid styleClass="panelgridHeaderTable" columns="2">
                <ui:fragment>
                    <h:outputLink value="/dataverse.xhtml?id=#{DatasetPage.dataset.owner.id}">
                        <h:outputText id="nameOutput" value="#{DatasetPage.dataset.owner.name} Dataverse" style="font-size:1.5em;font-weight:bold; padding:4px 0 4px 34px; background: url(/resources/images/icon_dataverse.png) no-repeat 0 50%;"/>
                    </h:outputLink>
                </ui:fragment>
                <ui:fragment>
                    <p:panelGrid columns="2">
                        <ui:fragment>
                            <h:outputLink value="/dataverseuser.xhtml" rendered="#{empty dataverseSession.user}">
                                Create Account
                            </h:outputLink>
                            <h:outputText value="#{dataverseSession.user.firstName} #{dataverseSession.user.lastName}" rendered="#{!empty dataverseSession.user}"/>
                        </ui:fragment>
                        <ui:fragment>
                            <h:outputLink value="/loginpage.xhtml" rendered="#{empty dataverseSession.user}">
                                Log In
                            </h:outputLink>
                            <h:form id="headerForm">
                                <h:commandLink actionListener="#{dataverseSession.setUser(null)}" rendered="#{!empty dataverseSession.user}">
                                    Log Out
                                </h:commandLink>   
                            </h:form>                            
                        </ui:fragment>
                    </p:panelGrid>
                </ui:fragment>
            </p:panelGrid>
        </p:panel>

        <h:form id="datasetForm">
            <!-- Breadcrumbs Panel -->
            <p:panel styleClass="panelLayoutBlock breadcrumbNavBlock" rendered="#{empty DatasetPage.editMode}">
                
                <ui:repeat value="#{DatasetPage.dataset.owner.owners}" var="owner">                   
                    <h:outputLink value="/dataverse.xhtml?id=#{owner.id}">
                        <h:outputText value="#{owner.name} Dataverse"/>             
                    </h:outputLink> 
                    <h:outputText value=" > "/>
                </ui:repeat>
                <!--<br/>-->
                <h:outputLink value="/dataverse.xhtml?id=#{DatasetPage.dataset.owner.id}">
                    <h:outputText value="#{DatasetPage.dataset.owner.name} Dataverse"/> 
                </h:outputLink>
                
                <ui:fragment rendered="#{!empty DatasetPage.dataset.latestVersion.metadata.title}">
                    <h:outputText value=" > "/>
                    <h:outputText value="#{DatasetPage.dataset.latestVersion.metadata.title}" style="font-weight:bold;"/>
                </ui:fragment>
                
            </p:panel>
            
            <!-- Message Panel -->
            <p:panel styleClass="panelLayoutTitleBlock" rendered="#{!empty DatasetPage.editMode}">
                
                <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
                
                <!--<h:outputText value="Upload your dataset:" rendered="#{DatasetPage.editMode == 'CREATE'}"/>-->
                <!--<h:outputText value="Edit your dataset's information:" rendered="#{DatasetPage.editMode == 'INFO'}"/>-->
                <!--<h:outputText value="Edit your dataset's files:" rendered="#{DatasetPage.editMode == 'FILE'}"/>-->
                <!--<h:outputText value="Edit your dataset's metadata" rendered="#{DatasetPage.editMode == 'METADATA'}"/>-->
            </p:panel>

            <!-- Title / Button Panel -->
            <p:panel styleClass="panelLayoutBlock">
                <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
                    <ui:fragment>
                        <h:outputText value="#{DatasetPage.dataset.latestVersion.metadata.title}" rendered="#{empty DatasetPage.editMode or !(DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'CREATE')}" style="font-size:1.25em;font-weight:bold;"/>
                        <p:panelGrid styleClass="panelgridLayoutTable" columns="3" rendered="#{DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE'}">
                            <p:outputLabel value="Title" for="title"/>
                            <ui:fragment>
                                <p:inputText id="title" size="40" value="#{DatasetPage.dataset.latestVersion.metadata.title}"/>
                                <p:watermark for="title" value="Enter title..."/>
                            </ui:fragment>
                            <p:message for="title"/>

                            <h:outputText value="Host Dataverse"/>
                            <p:selectOneMenu value="#{DatasetPage.ownerId}" filter="true" filterMatchMode="startsWith" effect="none">
                                <f:selectItems value="#{dataverseServiceBean.findAll()}" var="dv" itemLabel="#{dv.name}" itemValue="#{dv.id}"/>
                            </p:selectOneMenu>
                            <ui:fragment>
                                &#160;
                            </ui:fragment>
                        </p:panelGrid>
                    </ui:fragment>
                    
                    <ui:fragment>
                        <p:panelGrid styleClass="panelgridLayoutTable" columns="2" rendered="#{!empty dataverseSession.user and empty DatasetPage.editMode}">
                            <p:panel styleClass="panelLayoutButtonBlock">
                                <p:menuButton id="editDataSet" value="Edit Dataset" iconPos="right">
                                    <p:menuitem id="editFiles" value="Add/Edit Files" actionListener="#{DatasetPage.edit('FILE')}" update="@all">
                                        <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                    </p:menuitem>
                                    <p:menuitem id="editMetadata" value="Edit Metadata" actionListener="#{DatasetPage.edit('METADATA')}" update="@all">
                                        <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                    </p:menuitem>
                                    <p:menuitem value="Edit Permissions" disabled="true"/>
                                </p:menuButton>
                            </p:panel>
                        </p:panelGrid>
                    </ui:fragment>
                </p:panelGrid>
            </p:panel>

            <!-- Citation -->
            <p:panel styleClass="panelLayoutBlock" rendered="#{empty DatasetPage.editMode or (DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE')}">
                <p:panelGrid styleClass="panelgridLayoutTable" columns="1" rendered="#{empty DatasetPage.editMode}">
                        <p:panel style="background-color: #F5F5F5;">
                            <h:outputText id="citation" value="#{DatasetPage.dataset.citation}"/>
                        </p:panel>
                        <p:panel>
                            <p:panelGrid columns="2">
                                <p:commandButton value="Copy Citation" disabled="true"/>
                                <h:outputLink onclick="PF('whyCite').show();" value="javascript:void(0)">
                                    <h:outputText value="Why cite?" style="color: green"/>
                                </h:outputLink>
                                <p:dialog header="Why cite?" widgetVar="whyCite" modal="true" height="100">
                                    <h:outputText value="Info on why to use a data citation."/>
                                </p:dialog>
                            </p:panelGrid>
                        </p:panel>
                </p:panelGrid>
                <p:panelGrid styleClass="panelgridLayoutTable" columns="2" rendered="#{DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE'}">
                    <h:outputText value="Data Citation"/>
                    <p:panelGrid styleClass="panelgridLayoutTable" columns="3">                       
                     <p:column>
                        <p:dataTable binding="#{DatasetPage.dataTableAuthors}"  value="#{DatasetPage.editVersion.metadata.datasetAuthors}" var="currentAuthor">
                            <p:column><div >               
                              <div  >
                                <h:outputText value="Author*:"/>
                                <p:inputText id="input_authorName"
                                               styleClass="input_authorName"
                                               value="#{currentAuthor.name}"
                                               size="45"
                                               maxlength="255"
                                               requiredMessage="This field is required." />                                
                                <h:outputText styleClass="vdcEditStudyFormatExample" value="(LastName, FirstName)"/>

                              </div>
                              <div  styleClass="vdcEditStudyFieldFloat2" >
                                <h:outputText value="Author Affiliation:"/>
                                <p:inputText id="input_authorAffiliation" size="45" maxlength="255"
                                               value="#{currentAuthor.affiliation}">                                  
                                </p:inputText>

                              </div>
                            </div>
                                </p:column> 
                        </p:dataTable>
                      </p:column>                       
                        <p:outputLabel value="Date" for="date" />
                        <p:inputText id="date" value="#{DatasetPage.dataset.editVersion.metadata.productionDate}" />
                        <p:message for="date" />

                    </p:panelGrid>
                </p:panelGrid>
                
            </p:panel>
            <!-- Description Panel -->
            <p:panel styleClass="panelLayoutBlock" rendered="#{empty DatasetPage.editMode or (DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE')}">
                <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
                    <ui:fragment>
                        <h:outputText value="#{DatasetPage.dataset.description}" rendered="#{empty DatasetPage.editMode}"/>
                        <p:panelGrid columns="3" styleClass="panelgridFormTable" rendered="#{DatasetPage.editMode == 'INFO' or DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE'}">
                            <p:outputLabel value="Description" for="description"/>
                            <ui:fragment>
                                <p:inputTextarea id="description" value="#{DatasetPage.dataset.description}"
                                                 rows="5" cols="50" counter="counter" maxlength="1000"
                                                 counterTemplate="{0} characters remaining" autoResize="false"/>
                                <h:outputText id="counter" style="display:block;"/>
                            </ui:fragment>
                            <p:message for="description"/>
                        </p:panelGrid>
                    </ui:fragment>
                    <ui:fragment>
                        &#160;
                    </ui:fragment>
                </p:panelGrid>
            </p:panel>

            <!-- Content Panel -->
            <p:panel id="content" styleClass="panelLayoutBlock" rendered="#{DatasetPage.editMode != 'INFO'}">
                <p:tabView id="tabView" widgetVar="content" activeIndex="#{DatasetPage.selectedTabIndex}">
                    <p:tab id="dataFilesTab" title="Files" rendered="#{(empty DatasetPage.editMode or DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}" >
                        <p:message for="fileUpload" showDetail="true"/>
                        <p:fileUpload id="fileUpload" dragDropSupport="true" auto="true" multiple="true" rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}"
                                      fileUploadListener="#{DatasetPage.handleFileUpload}" update="filesTable" label="Select Files to Add" style="margin-top:.5em;"/>
                        <p:dataTable id="filesTable" value="#{DatasetPage.dataset.files}" var="file">
                            <p:column>
                                <h:outputText id="fileNameOutput" value="#{file.name}" rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}"/>
                                <p:inputText id="fileName" value="#{file.name}" rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}"/>
                                <p:message for="fileName"/>
                            </p:column>
                            <p:column>
                                <h:outputText id="fileTypeOutputTabular" value="Tabular Data" rendered="#{file.tabularData}"/>
                                <h:outputText id="fileTypeOutputRegular" value="#{file.contentType}" rendered="#{!(file.tabularData)}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab id="metadataTab" title="Metadata" rendered="#{(empty DatasetPage.editMode or DatasetPage.editMode == 'METADATA')}">
                        <p:panelGrid columns="3">

                        </p:panelGrid>
                    </p:tab>
                    <p:tab id="versionsTab" title="Versions" rendered="#{empty DatasetPage.editMode}"/>
                </p:tabView>
            </p:panel>
            
            <!-- Create/Save Dataset Button Panel -->
            <p:panel styleClass="panelLayoutButtonBlock" rendered="#{!empty DatasetPage.editMode}">
                <p:commandButton id="save" value="#{DatasetPage.editMode == 'CREATE' ? 'Create Dataset' : 'Save Changes'}" action="#{DatasetPage.save}" update="@all">
                    <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="#{DatasetPage.editMode == 'METADATA' ? 1 : DatasetPage.selectedTabIndex}"/>
                </p:commandButton>
                <p:commandButton id="cancel" value="Cancel" action="#{DatasetPage.cancel}" process="@this" update="@all"  rendered="#{DatasetPage.editMode != 'CREATE'}">
                    <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="#{DatasetPage.editMode == 'METADATA' ? 1 : DatasetPage.selectedTabIndex}"/>
                </p:commandButton>
                <p:button id="cancelCreate" value="Cancel" outcome="/dataverse.xhtml?id=#{DatasetPage.ownerId}"  rendered="#{DatasetPage.editMode == 'CREATE'}" />
            </p:panel>
        </h:form>
        <!-- Crazy Egg Tracking -->
        <script type="text/javascript">
            setTimeout(function(){var a=document.createElement("script");
            var b=document.getElementsByTagName("script")[0];
            a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0020/3547.js?"+Math.floor(new Date().getTime()/3600000);
            a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
        </script>
    </h:body>
</html>