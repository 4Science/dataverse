<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"  
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">  

    <h:head>  
        <style type="text/css">
            .column75{width: 75%;height:auto}
            .column25{width: 25%;height:auto}
            .column60{width: 60%;height:auto}
            .column40{width: 40%;height:auto}            
        </style>
    </h:head>  

    <h:body> 
        <f:metadata>
            <f:viewParam name="id" value="#{DataversePage.dataverse.id}"/>
            <f:viewParam name="ownerId" value="#{DataversePage.ownerId}"/>
            <f:viewAction action="#{DataversePage.init}" />
        </f:metadata>   

        <!-- Header Panel -->
        <p:panel  style="background-color: lightskyblue; height:70px;">
            <ui:repeat value="#{DataversePage.dataverse.owners}" var="owner">                   
                <h:outputLink value="/dataverse.xhtml?id=#{owner.id}">
                    <h:outputText value="#{owner.name}" />             
                </h:outputLink> 
                <h:outputText value=" > "/>
            </ui:repeat>
            <br/>
            <h:outputLink value="/dataverse.xhtml?id=#{DataversePage.dataverse.id}" rendered="#{DataversePage.dataverse.id != null}">
                <h:outputText value="#{DataversePage.dataverse.name} Dataverse" /> 
            </h:outputLink>
        </p:panel>   

        <h:form id="dataverseForm">            
            <!-- Message Panel -->
            <p:panel rendered="#{DataversePage.editMode}">
                <h:outputText value="Edit your dataverse's information:" rendered="#{DataversePage.dataverse.id != null}"/>
                <h:outputText value="Create a child dataverse:" rendered="#{DataversePage.dataverse.id == null and DataversePage.ownerId != null}"/>
                <h:outputText value="Create the root dataverse:" rendered="#{DataversePage.dataverse.id == null and DataversePage.ownerId == null}"/>
            </p:panel>

            <!-- Name Panel -->
            <p:panel>
                <h:outputText value="#{DataversePage.dataverse.name} Dataverse" rendered="#{!DataversePage.editMode}"/>                
                <p:panelGrid columns="2"  columnClasses="column60,column40" rendered="#{DataversePage.editMode}" >
                    <p:panelGrid columns="2">
                        <ui:fragment>
                            <p:inputText  id="name" value="#{DataversePage.dataverse.name}"/>
                            <p:outputLabel value=" Dataverse" for="name"/>
                            <p:watermark for="name" value="Enter name..." /> 
                        </ui:fragment>
                        <p:message for="name" /> 
                    </p:panelGrid>
                    <p:panelGrid columns="2" rendered="#{DataversePage.ownerId != null}">
                        <h:outputText value="Host Dataverse"/>
                        <p:selectOneMenu value="#{DataversePage.ownerId}" filter="true" filterMatchMode="startsWith" effect="none">    
                            <f:selectItems value="#{dataverseServiceBean.findAll()}" var="dv" itemLabel="#{dv.name}" itemValue="#{dv.id}" 
                                           itemDisabled="#{dv eq DataversePage.dataverse or dv.owners.contains(DataversePage.dataverse)}"/>   
                        </p:selectOneMenu>  
                    </p:panelGrid>
                </p:panelGrid> 
            </p:panel>

            <!-- Info / Buttons Panel -->
            <p:panel>
                <p:panelGrid columns="2" columnClasses="column75,column25">
                    <p:panel>
                        <p:panelGrid columns="3">
                            <p:outputLabel value="Alias" for="alias" />
                            <h:outputText value="#{DataversePage.dataverse.alias}" rendered="#{!DataversePage.editMode}" />
                            <p:inputText  id="alias" value="#{DataversePage.dataverse.alias}" rendered="#{DataversePage.editMode}" />
                            <p:message for="alias" />  

                            <p:outputLabel value="Contact E-mail" for="contactEmail" />
                            <h:outputText value="#{DataversePage.dataverse.contactEmail}" rendered="#{!DataversePage.editMode}" />
                            <p:inputText  id="contactEmail" value="#{DataversePage.dataverse.contactEmail}" rendered="#{DataversePage.editMode}"/>
                            <p:message for="contactEmail" />

                            <p:outputLabel value="Affiliation" for="affiliation"/>
                            <h:outputText value="#{DataversePage.dataverse.affiliation}" rendered="#{!DataversePage.editMode}" />
                            <p:inputText  id="affiliation" value="#{DataversePage.dataverse.affiliation}" rendered="#{DataversePage.editMode}"/>
                            <p:message for="affiliation" />

                        </p:panelGrid> 
                    </p:panel>

                    <p:panel>
                        <p:menuButton value="Edit Dataverse" rendered="#{!DataversePage.editMode}" iconPos="right"> 
                            <p:menuitem value="Edit Info" actionListener="#{DataversePage.edit}" update="@all" />
                            <p:menuitem value="Edit Theme" disabled="true"/>  
                            <p:menuitem value="Edit Permissions" disabled="true"/>
                        </p:menuButton>
                        <ui:fragment rendered="#{DataversePage.editMode}">
                            <p:commandButton value="Save" actionListener="#{DataversePage.save}" update="@all" />
                            <p:commandButton value="Cancel" actionListener="#{DataversePage.cancel}" process="@this" update="@all"  rendered="#{DataversePage.dataverse.id != null}" />
                            <p:button value="Cancel" outcome="/dataverse.xhtml?id=#{DataversePage.ownerId}"  rendered="#{DataversePage.dataverse.id == null and DataversePage.ownerId != null}" />
                        </ui:fragment>
                    </p:panel>
                </p:panelGrid>
            </p:panel>

            <!-- Description Panel -->
            <p:panel>
                <h:outputText value="#{DataversePage.dataverse.description}" rendered="#{!DataversePage.editMode}" />
                <p:panelGrid columns="3"  rendered="#{DataversePage.editMode}">
                    <p:outputLabel value="Description" for="description"/>
                    <p:inputTextarea  id="description" value="#{DataversePage.dataverse.description}"
                                      rows="5" cols="30" counter="counter" maxlength="1000"       
                                      counterTemplate="{0} characters remaining." autoResize="false"/>
                    <h:outputText id="counter" /> 
                </p:panelGrid>
            </p:panel>            
        </h:form>

        <!-- Search / Share Panel -->
        <p:panel rendered="#{!DataversePage.editMode}">
            <p:panelGrid columns="2" columnClasses="column75,column25" >
                <p:panel>
                    <h:form id="searchForm">
                        <p:inputText id="search" />
                        <p:watermark for="search" value="Search this dataverse"/>
                        <p:commandButton value="Go" disabled="true" />
                    </h:form>
                </p:panel>

                <p:panel>
                    <h:form id="shareForm">
                        <p:menuButton id="shareData" value="Share Data" iconPos="right"> 
                            <p:menuitem value="Upload Dataset"  url="/dataset.xhtml?ownerId=#{DataversePage.dataverse.id}"/>
                            <p:menuitem value="Link to Existing Dataset" disabled="true"/>
                            <p:menuitem id="createDataverse" value="Create Dataverse" url="/dataverse.xhtml?ownerId=#{DataversePage.dataverse.id}"/>  
                            <p:menuitem value="Link to Existing Dataverse" disabled="true"/> 
                            <p:menuitem value="Create Query" disabled="true"/>                             
                        </p:menuButton>  
                    </h:form>
                </p:panel>
            </p:panelGrid>
        </p:panel>

        <!-- Content Panel -->
        <p:panel rendered="#{!DataversePage.editMode}">
            <p:dataList value="#{DataversePage.contents}" var="item">
                <ui:fragment rendered="#{item.class.simpleName eq 'Dataverse'}">                    
                    <h:outputText value="ยง "/>
                    <h:outputLink value="/dataverse.xhtml?id=#{item.id}">
                        <h:outputText value="#{item.name}"/>
                        <h:outputText value=" (#{item.affiliation})" rendered="#{!empty item.affiliation}" />
                    </h:outputLink>
                </ui:fragment>
                <ui:fragment rendered="#{item.class.simpleName eq 'Dataset'}">                
                    <h:outputLink value="/dataset.xhtml?id=#{item.id}">
                        <h:outputText value="#{item.title}"/>
                    </h:outputLink>
                    <h:outputText value=" by #{item.author}" rendered="#{!empty item.author}" />
                </ui:fragment>
            </p:dataList>
        </p:panel>

    </h:body> 
</html> 