<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
     xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
     xmlns:iqbs="http://xmlns.jcp.org/jsf/composite/iqbs">

    <!-- Navbar Panel -->
    <nav id="navbarFixed" class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom:0;">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavBar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <h:outputLink value="/">
                    <h:outputText styleClass="navbar-brand" value="Dataverse" style="color:#C55B28; padding-left:34px;background: url(/resources/images/icon_dataverse.png) no-repeat left center;background-size:20% auto;"/>
                </h:outputLink>
            </div>
            <div class="collapse navbar-collapse" id="topNavBar">

                <ul class="nav navbar-nav navbar-right">
                    <!--                    <li class="dropdown">
                                            <a value="#" class="dropdown-toggle" data-toggle="dropdown">
                                                Search <b class="caret"></b>
                                            </a>
                                            <div class="dropdown-menu">
                                                <form style="width:420px; padding:10px;">
                                                    <input style="display: inline-block;" type="text" size="40" value="" placeholder="Search the entire app..." autocomplete="off" class="ui-autocomplete-input ui-inputfield ui-widget ui-state-default ui-corner-all" aria-disabled="false" aria-readonly="false" aria-multiline="false"/>
                                                    <button style="margin-left:1em; display: inline-block;" type="submit" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false">
                                                        <span class="ui-button-text ui-c">Find</span>
                                                    </button>
                                                </form>
                                            </div>
                                        </li>-->
                    <li>
                        <a value="#" id="navbar-search-toggle">
                            <span class="glyphicon glyphicon-search"></span>
                        </a>
                    </li>
                    <form class="navbar-form navbar-left" role="search" style="display:none;">
                        <div class="form-group">
                            <label class="sr-only" for="navbarsearch">Search</label>
                            <input id="navbarsearch" type="text" class="form-control ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all" size="28" value="" placeholder="Search all Dataverses..." style="font-size:1em;margin-right:1em;" />
                        </div>
                        <button type="submit" class="btn btn-default" onclick="window.location = '/?q=' + document.getElementById('navbarsearch').value; return false;">
                            <span class="glyphicon glyphicon-search" style="margin-right:.3em;"/> Find
                        </button>
                    </form>
                    <li>
                        <h:outputLink value="http://thedata.org/about-testing" target="_blank">
                            About
                        </h:outputLink>
                    </li>
                    <li>
                        <h:outputLink value="https://github.com/IQSS/dataverse_temp" target="_blank">
                            Software
                        </h:outputLink>
                    </li>
                    <li>
                        <h:outputLink value="http://thedata.org/resources-testing" target="_blank">
                            Resources
                        </h:outputLink>
                    </li>
                    <li class="dropdown">
                        <a value="#" class="dropdown-toggle" data-toggle="dropdown">
                            Support <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <h:outputLink value="http://www.thedata.org/support-test" target="_blank">
                                    <h:outputText value="Report Bugs + Community" />
                                </h:outputLink>
                            </li>
                            <li>
                                <h:outputLink value="/guides/index.html" target="_blank">
                                    User Guides
                                </h:outputLink>
                            </li>
                        </ul>
                    </li>
                    <ui:fragment rendered="#{dataverseSession.user.guest}">
                        <li>
                            <h:outputLink value="/dataverseuser.xhtml?editMode=CREATE">
                                Sign Up
                            </h:outputLink>
                        </li>
                    </ui:fragment>
                    <ui:fragment rendered="#{dataverseSession.user.guest}">
                        <li>
                            <h:outputLink value="/loginpage.xhtml">
                                Log In
                            </h:outputLink>
                        </li>
                    </ui:fragment>
                    <ui:fragment rendered="#{!dataverseSession.user.guest}">
                        <li class="dropdown">
                            <a value="#" class="dropdown-toggle" data-toggle="dropdown">
                                <h:outputText value="#{dataverseSession.user.firstName} #{dataverseSession.user.lastName}" rendered="#{empty (userNotificationServiceBean.findUnreadByUser(dataverseSession.user.id))}"/>
                                <h:outputText value="#{dataverseSession.user.firstName} #{dataverseSession.user.lastName} (#{(userNotificationServiceBean.findUnreadByUser(dataverseSession.user.id)).size()})" 
                                              rendered="#{!empty (userNotificationServiceBean.findUnreadByUser(dataverseSession.user.id))}"/> <b class="caret"></b>                                
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <h:outputLink value="/dataverseuser.xhtml" >
                                        <f:param name="editMode" value="INFO" />                                    
                                        <f:param name="selectTab" value="notifications" />
                                    <h:outputText value="Notifications" />
                                    </h:outputLink>
                                </li>
                                <li>
                                    <h:outputLink value="/dataverseuser.xhtml?editMode=INFO" >
                                        <h:outputText value="Account Page" />
                                    </h:outputLink>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <h:form styleClass="navbar-form navbar-left" pt:role="logout">
                                        <h:commandButton value="Log Out" styleClass="btn btn-default" actionListener="#{dataverseSession.setUser(null)}"/>
                                    </h:form>
                                 </li>
                            </ul>
                        </li>
                    </ui:fragment>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header Panel -->
    <ui:fragment rendered="#{showDataverseHeader}">
        <div class="container" style="background:#B5E5F5; margin:0 auto .5em auto; padding:2em 1em;">
            <div style="display:table-row;">
            <ui:fragment rendered="#{!empty dataverse.name}">
                <div style="height:100px;width:100px;background:#EEE;display:table-cell;text-align:center;">
                    <span style="text-decoration:line-through;line-height:100px;">(Logo)</span>
                </div>
            </ui:fragment>
            <ui:fragment rendered="#{!empty dataverse.name}">
                <div style="display:table-cell; padding-left:1em;">
                    <a href="/dataverse.xhtml?id=#{dataverse.id}" style="font-size: 1.3em;">#{dataverse.name} Dataverse</a> <h:outputText value=" (#{dataverse.affiliation})" rendered="#{!empty dataverse.affiliation}"/>
                </div>
            </ui:fragment>
            <ui:fragment rendered="#{empty dataverse.name}">
                <div style="display:table-cell;">
                    <h:outputText style="font-size: 1.3em;" value="New Dataverse"/>
                </div>
            </ui:fragment>
            <ui:fragment rendered="#{!empty dataverse.name}">
                <div style="display:table-cell; padding-left:2em; font-size:1.3em;">
                    <span style="color:#777;">This, Right-Here, Is A Static Tagline For This Dataverse, Y'All</span>
                </div>
            </ui:fragment>
            </div>
        </div>
    </ui:fragment>

    <!-- Breadcrumbs Panel -->
    <ui:fragment rendered="#{showBreadcrumbs}">
        <div id="breadcrumbNavBlock" class="container">
            <!-- Dataverses -->
            <ui:repeat value="#{dataverseHeaderFragment.getDataverses(dataverse)}" var="dv" varStatus="status">

                <h:outputText value=" > " styleClass="breadcrumbCarrot" rendered="#{!status.first}"/>
                
                <div style="float:left; position:relative;">
                    
                    <div class="dropdown #{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? 'dropdown-toggle keep-on' : ''}" data-toggle="#{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? 'dropdown' : ''}" data-delay="#{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? '800' : ''}" data-hover="#{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? 'dropdown' : ''}" data-target="#{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? '#' : ''}" data-close-others="#{!empty dataverseServiceBean.findByOwnerId(dv.getId()) ? 'true' : ''}">
                        <h:outputText value="#{dv.name} Dataverse" style="font-weight: #{dataverse.id == dv.id ? 'bold' : 'normal'}" rendered="#{dataverse.id == dv.id and dataset == null}"/>
                        <ui:fragment rendered="#{dataverse.id != dv.id or dataset != null}" >
                            <a id="breadcrumbLnk#{status.index}" href="/dataverse.xhtml?id=#{dv.id}">
                                <h:outputText value="#{dv.name} Dataverse"/>
                            </a>
                        </ui:fragment>

                        <ui:fragment rendered="#{!empty dataverseServiceBean.findByOwnerId(dv.getId())}">
                            <a id="breadcrumbLnkTree#{status.index}" title="Browse #{dv.name} Dataverse" style="font-weight: #{dataverse.id == dv.id ? 'bold' : 'normal'}; cursor: pointer; cursor: hand;" role="button">
                                <span class="glyphicon glyphicon-chevron-down" style="vertical-align:middle;padding-bottom:2px;"></span>
                            </a>
                        </ui:fragment>
                    </div>
                    <div class="dropdown-menu" role="menu" aria-labelledby="breadcrumbLnk#{status.index}" rendered="#{!empty dataverseServiceBean.findByOwnerId(dv.getId())}">
                        <p:tree value="#{dataverseHeaderFragment.getDataverseTree(dv)}" var="node"  cache="true" id="tree">
                            <p:treeNode>
                                <h:outputText value="#{node.name} Dataverse" style="font-weight:bold;" rendered="#{dataverse.id == node.id and dataset == null}"/>
                                <h:outputLink value="/dataverse.xhtml?id=#{node.id}" rendered="#{dataverse.id != node.id or dataset != null}">
                                    <h:outputText value="#{node.name} Dataverse"/>
                                </h:outputLink>
                            </p:treeNode>
                        </p:tree>
                    </div>
                </div>

            </ui:repeat>

            <!-- Dataset, if available -->
            <ui:fragment rendered="#{!empty dataset.latestVersion.title}">
                <h:outputText value=" > " styleClass="breadcrumbCarrot"/>
                <h:outputText value="#{dataset.latestVersion.title}" style="font-weight:bold;"/>
            </ui:fragment>
        </div>

    </ui:fragment>

    <!-- Message Panel -->
    <ui:fragment rendered="#{showMessagePanel}">
        <div class="container messagePanel">
            <iqbs:messages collapsible="true" />
        </div>
    </ui:fragment>

</div>
