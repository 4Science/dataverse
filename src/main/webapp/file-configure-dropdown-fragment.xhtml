<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    xmlns:pt="http://java.sun.com/jsf/passthrough"
    xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:o="http://omnifaces.org/ui"
    xmlns:iqbs="http://xmlns.jcp.org/jsf/composite/iqbs">

        <div class="btn-group" >
            <button type="button" id="editFile" class="btn btn-default btn-access dropdown-toggle" data-toggle="dropdown">
                <span class="glyphicon glyphicon-cog"/> #{bundle['dataset.configureBtn']} <span class="caret"></span>
            </button>
            <ul class="dropdown-menu pull-right text-left" role="menu" >
                <!-- Worldmap unpublished -->
                <li jsf:rendered="#{worldMapPermissionHelper.canSeeMapButtonReminderToPublishFromPage(fileMetadata)}">
                    <a onclick="PF('mapData_popup').show()" href="javascript:void(0);" >#{bundle['file.map']}</a>
                </li>
                <!-- Worldmap published -->
                <li jsf:rendered="#{worldMapPermissionHelper.canUserSeeMapDataButtonFromPage(fileMetadata)}">
                    <a href="#{fileMetadata.dataFile.getMapItURL(dataverseSession.user.id)}" >#{bundle['file.map']}</a>
                </li>
                <!-- Configure options (currently just psi) -->
                <ui:repeat value="#{externalTools}" var="tool" rendered="#{dataverseSession.user.authenticated and canUpdateDataset and (fileMetadata.dataFile.tabularData or worldMapPermissionHelper.canUserSeeMapDataButtonFromPage(fileMetadata) or worldMapPermissionHelper.canSeeMapButtonReminderToPublishFromPage(fileMetadata))}">
                    <li>
                        <p:commandLink
                            update="@([id$=psiBrowserPopup])"
                            oncomplete="PF('psiBrowserPopup').show()">
                            #{tool.displayName}
                        </p:commandLink>
                        <!-- Pop-up for the only tool we currently pull with this code, the psi tool. -->
                        <!-- This will need to become more modular as we add more tools. -->
                        <!-- Placed here so it can access the tool variable for this file -->

                        <p:dialog id="psiBrowserPopup" header="#{bundle['file.psiBrowserInfoDialog.header']}" widgetVar="psiBrowserPopup">
                            <p class="help-block">
                                <span class="glyphicon glyphicon-info-sign"/> #{bundle['file.psiBrowserInfoDialog.tip']}
                            </p>
                            <div class="button-block">
                                <!-- This calls the alert in dataset page and works, but probably should be somewhere else -->
                                <p:commandButton 
                                    action="#{DatasetPage.psiExternalAlert()}" 
                                    value="#{bundle['file.configureButton']}" 
                                    onclick="PF('psiBrowserPopup').hide();window.open('#{tool.toolUrl}', '_blank')"
                                    update=":messagePanel">
                                </p:commandButton>
                                <button type="button" class="btn btn-default" onclick="PF('psiBrowserPopup').hide();PF('blockDatasetForm').hide();" value="#{bundle.cancel}">#{bundle.cancel}</button>
                            </div>
                        </p:dialog>
                    </li>
                </ui:repeat>
            </ul>
        </div>
        
        <p:dialog header="#{bundle['file.mapData.unpublished.header']}" widgetVar="mapData_popup" modal="true" rendered="#{(worldMapPermissionHelper.canUserSeeMapDataButtonFromPage(fileMetadata) or worldMapPermissionHelper.canSeeMapButtonReminderToPublishFromPage(fileMetadata))}">
            <p class="help-block">
                <span class="text-danger"><span class="glyphicon glyphicon-warning-sign"/> #{bundle['file.mapData.unpublished.message']}</span>
            </p>
            <div class="button-block">
                <button type="button" class="btn btn-default" onclick="PF('mapData_popup').hide();PF('blockDatasetForm').hide();">
                    #{bundle.close}
                </button>
            </div>
        </p:dialog>

</ui:composition>