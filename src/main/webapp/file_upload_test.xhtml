<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:p="http://primefaces.org/ui">

  <h:head>
   
  </h:head>

  <h:body>
    <ui:composition template="/dataverse_template.xhtml">
      <ui:param name="pageTitle" value="File Upload Test - #{dataverseServiceBean.findRootDataverse().name} #{bundle.dataverse}"/>
      <ui:param name="showDataverseHeader" value="false"/>
      <ui:define name="body">
          <f:metadata>
                <f:viewAction action="#{FileUploadTestPage.init}" />
          </f:metadata>
          <div>        
              <h4>Test Add/Replace functions</h4>
              <ui:fragment>
                  <p>
                    <h:outputText value="#{FileUploadTestPage.yesYes()}" escape="false" /> 
                   </p>

                <ui:fragment rendered="#{FileUploadTestPage.newlyAddedFile != null}">
    
                    <h4>Added!: #{FileUploadTestPage.newlyAddedFile.displayName }</h4>

                    <hr />
                   
                </ui:fragment>

                  
                <ui:fragment rendered="#{FileUploadTestPage.fileToReplace == null}">
                <h3>Add New File</h3>
                </ui:fragment>
                <ui:fragment id="idFileName" rendered="#{(FileUploadTestPage.fileToReplace != null) and (FileUploadTestPage.fileToReplace.released)}">
                    <h3>Replace File: 
                        <span style="color:#006699;">                            
                        <h:outputText id="fileLabel" value="#{FileUploadTestPage.fileToReplace.displayName}"  />
                        </span>
                    </h3>
                </ui:fragment>
                
                <!-- start: BASIC FORM 1 -->
                <h:form>
                  <p:fileUpload id="fileUpload" styleClass="margin-bottom" 
                                dragDropSupport="true" auto="true" 
                                multiple="false" 
                                rendered="#{!FileUploadTestPage.didPhase1Succeed()}"
                                  fileUploadListener="#{FileUploadTestPage.handleFileUpload}"                                   
                                  label="#{bundle['file.selectToAddBtn']}"
                                  widgetVar="fileUploadWidget"
                                  update="timeArea,dtFileList,idUploadError,fileUpload,phaseMsg"
                                  onstart="javascript:console.log('starting...');"
                                  sizeLimit="#{FileUploadTestPage.getMaxFileUploadSizeInBytes()}" 
                                  invalidSizeMessage="File exceeds our limits. Please contact support. " />
                </h:form>
                    
                <!-- end BASIC FORM 1 -->
                  <hr />
              </ui:fragment>
              
             <!-- START: Show replacement file -->
            <h3>Phase Messages</h3>
            <h:panelGroup id="phaseMsg" layout="block">
                <ui:fragment rendered="#{FileUploadTestPage.didPhase1Succeed()}">
                    <h:outputText id="p1Success"  value="Phase 1 Worked!!!" />
                    <h:form>
                        <h:commandLink id="idSaveLink"  action="#{FileUploadTestPage.runPhase2FileSave}">
                            <h:outputText id="p1Success"  value="Save file" />            
                        </h:commandLink>
                    </h:form>
                    <br />New file: <h:outputText id="fm1" value="#{FileUploadTestPage.replacementFileMetadata.label}" />
                </ui:fragment>
                
             </h:panelGroup>    
             <!-- END Show replacement file -->
             <!-- START: UPLOAD ERROR -->
               <h:panelGroup id="idUploadError" layout="block" >
                <!--ui:fragment id="idUploadError" rendered="#{FileUploadTestPage.hasAddReplaceError()}"-->
                    <div jsf:id="errAlert" class="alert alert-warning" rendered="#{FileUploadTestPage.hasAddReplaceError()}" >
                      <h:outputText id="errMsgString" value="#{FileUploadTestPage.getErrorMessageString()}"  />
                        <script>
                            console.log("error!");
                        </script>
                    </div>
              </h:panelGroup>    
            <!-- END UPLOAD ERROR -->
            <hr />

              
            
              <!-- start: DATASET + file listing -->
                <ui:fragment rendered="#{FileUploadTestPage.dataset == null}">
                    No dataset chosen.
                </ui:fragment>    

              
              <h4>
               <h:panelGroup id="timeArea" layout="block">
                 <h:outputText id="currentTime" value="#{FileUploadTestPage.getNewTimeTest()}"/>
              </h:panelGroup>    
              </h4>  

          
             
                <!-- END: UPLOAD ERROR -->

                <ui:fragment id="fileArea" rendered="#{FileUploadTestPage.dataset != null}">
                 
                 
                    <!-- START: SHOW PUBLISH BUTTON -->
                    <ui:fragment id="idPublishDatasetArea" rendered="#{!FileUploadTestPage.datasetVersion.released}">
                        <script src="#{resource['js/test_replace.js']}?time=#{now};"></script>
                        <span id="idPublishDataset" class="btn btn-success">Publish Dataset</span>
                    </ui:fragment>
                    <!-- END: SHOW PUBLISH BUTTON -->
                    
                    <h4>#{FileUploadTestPage.dataset.displayName } v#{FileUploadTestPage.dataset.versionNumber }</h4>

                    <ui:include src="file_replace/dataset_file_list.xhtml"></ui:include>

                  
                </ui:fragment>
              <!-- end DATASET + file listing -->

            <!-- START: REACT TEST -->
              <ui:fragment>
                <script src="https://unpkg.com/react@latest/dist/react.min.js"></script>
                <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
                <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
                <div id="react-container"></div>
                <script type="text/babel">
              
                  ReactDOM.render(
                     <ul>
                        <li>item 1</li>
                        <li>item 2</li>
                        <li>item 3</li>
                     </ul>,
                      document.getElementById('react-container')
                  )

                </script>
                  
              </ui:fragment>
            <!-- END REACT TEST -->
          </div>
      </ui:define>
    </ui:composition>
  </h:body>
</html>
