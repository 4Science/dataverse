<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
    </h:head>

    <h:body>
        <f:metadata>
            <f:viewParam name="dataverseId" value="#{manageGroupsPage.dataverseId}"/>
            <f:viewAction action="#{manageGroupsPage.init}"/>
            <f:viewAction action="#{dataverseHeaderFragment.initBreadcrumbs(manageGroupsPage.dataverse, bundle['dataverse.manageGroups.pageTitle'])}"/>
        </f:metadata>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{bundle['dataverse.manageGroups.pageTitle']}"/>
            <ui:param name="dataverse" value="#{manageGroupsPage.dataverse}"/>
            <ui:param name="showMessagePanel" value="#{true}"/>
            <ui:define name="body">
                <h:form id="manageGroupsForm">
                    <div class="form-group clearfix">
                        <div class="pull-right">
                            <p:commandLink type="button" id="createGroup" styleClass="btn btn-default"
                                           actionListener="#{manageGroupsPage.initExplicitGroupDialog}"
                                           update="explicitGroupNewDialog" oncomplete="explicitGroupForm.show();handleResizeDialog('explicitGroupNewDialog');bind_bsui_components();">
                                <span class="glyphicon glyphicon-plus"/> #{bundle['dataverse.manageGroups.createBtn']}
                            </p:commandLink>
                        </div>
                    </div>
                    <div>
                        <div id="no-groups-message" class="panel panel-default" jsf:rendered="#{empty manageGroupsPage.explicitGroups}">
                            <div class="panel-body">
                                <span class="help-block h3">#{bundle['dataverse.manageGroups.noGroups.why.header']}</span>
                                <ul>
                                    <li><h:outputText value="#{bundle['dataverse.manageGroups.noGroups.why.reason1']}" escape="false"/></li>
                                    <li><h:outputText value="#{bundle['dataverse.manageGroups.noGroups.why.reason2']}" escape="false"/></li>
                                </ul>
                                <span class="help-block h3">#{bundle['dataverse.manageGroups.noGroups.how.header']}</span>
                                <ul>
                                    <li><h:outputText value="#{bundle['dataverse.manageGroups.noGroups.how.tip1']}" escape="false"/></li>
                                    <li>
                                        <h:outputFormat value="#{bundle['dataverse.manageGroups.noGroups.how.tip2']}" escape="false">
                                            <f:param value="#{manageTemplatesPage.dataverse.alias}"/>
                                        </h:outputFormat>
                                    </li>
                                </ul>
                                <p>
                                    <h:outputFormat value="#{bundle['dataverse.manageGroups.noGroups.getStarted']}" escape="false">
                                        <f:param value="#{systemConfig.guidesBaseUrl}"/>
                                        <f:param value="#{systemConfig.version}"/>
                                    </h:outputFormat>
                                </p>
                            </div>
                        </div>

                        <p:dataTable id="allGroups" var="explicitGroup" value="#{manageGroupsPage.explicitGroups}"
                                     rendered="#{!empty manageGroupsPage.explicitGroups}">
                            <p:column width="31%" sortBy="name" headerText="#{bundle['dataverse.manageGroups.tab.header.name']}">
                                <h:outputText value="#{explicitGroup.displayName}" />
                            </p:column>
                            <p:column width="13%" sortBy="createDate" headerText="#{bundle['dataverse.manageGroups.tab.header.date']}">
                                <h:outputText value="temp" />
                            </p:column>
                            <p:column width="8%" class="text-center" sortBy="usageCount" headerText="#{bundle['dataverse.manageGroups.tab.header.userCount']}">
                                <h:outputText value="#{manageGroupsPage.getGroupAuthenticatedUserCount(explicitGroup)}" />
                            </p:column>
                            <p:column width="10%" class="text-center" sortBy="usageCount" headerText="#{bundle['dataverse.manageGroups.tab.header.responses']}">
                                <h:outputText value="#temp" />
                            </p:column>
                            <p:column width="38%" class="col-manage-action text-center" headerText="#{bundle['dataverse.manageGroups.tab.header.action']}">
                                <div class="button-block">
                                    <div class="btn-group" role="group">
                                        <p:commandLink type="button" styleClass="btn btn-default bootstrap-button-tooltip"
                                                       action="#{manageGroupsPage.viewSelectedGroup(explicitGroup)}"
                                                       oncomplete="viewGroup.show()"
                                                       update=":manageGroupsForm"
                                                       title="#{bundle['dataverse.manageGroups.tab.action.btn.view']}">
                                            <span class="glyphicon glyphicon-eye-open"></span>
                                        </p:commandLink>
                                        <p:commandLink type="button" styleClass="btn btn-default bootstrap-button-tooltip"
                                                       action="#{manageGroupsPage.setSelectedGroup(explicitGroup)}"
                                                       oncomplete="deleteConfirmation.show()"
                                                       title="#{bundle['dataverse.manageGroups.tab.action.btn.delete']}">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </p:commandLink>
                                    </div>
                                </div>
                            </p:column>
                        </p:dataTable>
                    </div>

                    <p:dialog header="#{bundle['dataverse.manageGroups.tab.action.btn.delete.dialog.header']}" widgetVar="deleteConfirmation" modal="true">
                        <p class="help-block">
                            <span class="glyphicon glyphicon-warning-sign text-danger"/> <span class="text-danger">#{bundle['dataverse.manageGroups.tab.action.btn.delete.dialog.tip']}</span>
                        </p>
                        <div class="button-block">
                            <p:commandButton value="#{bundle.continue}" onclick="deleteConfirmation.hide()" action="#{manageGroupsPage.deleteGroup()}" update="@all" />
                            <p:commandButton value="#{bundle.cancel}" onclick="deleteConfirmation.hide()" type="button" />
                        </div>
                    </p:dialog>
                    
                    <p:dialog id="viewGroup" styleClass="largePopUp" header="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.header']}" widgetVar="viewGroup" modal="true">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="select_DatasetTemplate" class="col-sm-3 control-label">
                                    <span data-toggle="tooltip" data-placement="auto right" class="tooltiplabel text-info" data-original-title="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.datasetGuestbook.title']}">
                                        #{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.datasetGuestbook']}
                                    </span>
                                </label>
                                <div class="col-sm-7">
                                    <p class="form-control-static">
                                        #{manageGroupsPage.selectedGroup.displayName}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="select_DatasetTemplate" class="col-sm-3 control-label">
                                    <span data-toggle="tooltip" data-placement="auto right" class="tooltiplabel text-info" data-original-title="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.userCollectedData.title']}">
                                        #{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.userCollectedData']}
                                    </span>
                                </label>
                            </div>
                        </div>

                        <p:dataTable id="groupMembers"
                                     var="groupMember"
                                     value="#{manageGroupsPage.getExplicitGroupMembers(manageGroupsPage.selectedGroup)}">
                          <!-- Member Name -->
                          <p:column width="31%"
                                    sortBy="#{groupMember.getDisplayInfo().getTitle()}"
                                    headerText="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.groupView.name']}">
                            <h:outputText value="#{groupMember.getDisplayInfo().getTitle()}" />
                          </p:column>
                          <!-- Member Type -->
                          <p:column width="13%"
                                    sortBy="TODO"
                                    headerText="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.groupView.type']}">
                            <h:outputText value="#{manageGroupsPage.getRoleAssigneeTypeString(groupMember)}" />
                          </p:column>
                          <p:column width = "13%"
                                    headerText="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.groupView.action']}">
                            <p:commandLink type="button"
                                           styleClass="btn btn-default bootstrap-button-tooltip"
                                           update="groupMembers"
                                           action="#{manageGroupsPage.removeMemberFromSelectedGroup(groupMember)}"
                                           title="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.groupView.delete']}">
                              <span class="glyphicon glyphicon-trash"></span>
                            </p:commandLink>
                          </p:column>>
                          
                        </p:dataTable>
                        <label for="addUserForm" class="col-sm-2 control-label">
                            #{bundle['dataverse.permissions.explicitGroupEditDialog.roleAssigneeNames']}
                        </label>
                        <div class="col-sm-9">
                            <p:autoComplete id="addUserForm" placeholder="#{bundle['dataverse.permissions.usersOrGroups.assignDialog.userOrGroup.enterName']}"
                                            multiple="true" scrollHeight="180" forceSelection="true" emptyMessage="#{bundle['dataverse.permissions.usersOrGroups.assignDialog.userOrGroup.invalidMsg']}"
                                            value="#{manageGroupsPage.newExplicitGroupRoleAssignees}"
                                            completeMethod="#{manageGroupsPage.completeRoleAssignee}"
                                            var="roleAssignee"
                                            itemLabel="#{roleAssignee.displayInfo.title}" itemValue="#{roleAssignee}" converter="roleAssigneeConverter">
                                <p:column>
                                    <h:outputText value="#{roleAssignee.displayInfo.title}"/>
                                    <h:outputText value=" (#{roleAssignee.displayInfo.affiliation})" rendered="#{!empty roleAssignee.displayInfo.affiliation}"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{roleAssignee.identifier}"/>
                                </p:column>
                                <p:ajax process="@this" event="itemSelect" />
                                <p:ajax process="@this" event="itemUnselect" />
                            </p:autoComplete>
                            <!-- <p:message for="roleAssigneeName" display="text"/> -->
                        </div>
                        <!-- TODO Add user -->
                        <div class="button-block">
                        <p:commandLink type="button"
                                         id="saveGroup"
                                         styleClass="btn btn-default"
                                         actionListener="#{manageGroupsPage.saveExplicitGroup}"
                                         value="#{bundle['dataverse.manageGroups.tab.action.btn.view.dialog.groupView.save']}"
                                         update="@all">
                        </p:commandLink>
                        </div>
                    </p:dialog>
                    <!-- Explicit Group Edit Popup -->
                    <ui:include src="explicitGroup-new-dialog.xhtml"/>
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
