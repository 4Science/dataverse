<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
    </h:head>

    <h:body>
        <f:metadata>
            <f:viewParam name="dataverseId" value="#{manageGuestbooksPage.dataverseId}"/>
            <f:viewAction action="#{manageGuestbooksPage.init}"/>
        </f:metadata>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="Manage Dataset Guestbooks"/>
            <ui:param name="dataverse" value="#{manageGuestbooksPage.dataverse}"/>
            <ui:param name="showMessagePanel" value="#{true}"/>
            <ui:define name="body">
                <h:form id="manageGuestbooksForm">

                    <ui:fragment rendered="#{manageGuestbooksPage.dataverse.owner ne null}">
                        <label for="guestbookRoot" style="margin-top:.75em;">
                            <h:selectBooleanCheckbox id="guestbookRoot" value="#{manageGuestbooksPage.inheritGuestbooksValue}">
                                <p:ajax update="@form" listener="#{manageGuestbooksPage.updateGuestbooksRoot}" />
                            </h:selectBooleanCheckbox>
                            Include Guestbooks from  Parent Dataverse
                        </label>
                    </ui:fragment>

                    <div style="float:right; margin-bottom:.5em;">
                        <h:outputLink styleClass="btn btn-default" 
                                      value="/guestbook.xhtml?ownerId=#{manageGuestbooksPage.dataverse.id}">
                            <span class="glyphicon glyphicon-plus" style="margin-right:0.3em;"/> <h:outputText value="Create Dataset Guestbook"/>
                        </h:outputLink>
                    </div>
                    <div class="clearfix"/>

                    <div>
                        <ui:fragment rendered="#{empty manageGuestbooksPage.guestbooks}">
                            No Existing Guestbooks
                        </ui:fragment>    
                        <ui:fragment rendered="#{!empty manageGuestbooksPage.guestbooks}">    

                            <p:dataTable id="allGuestbooks" var="guestbook" value="#{manageGuestbooksPage.guestbooks}">
                                <p:column width="35%" sortBy="name" headerText="Guestbook Name">
                                    <h:outputText value="#{guestbook.name} " />
                                </p:column>
                                <p:column width="15%" sortBy="createDate" headerText="Date Created">
                                    <h:outputText value="#{guestbook.createTime} " />
                                </p:column>
                                <p:column width="10%" sortBy="usageCount" headerText="Usage">
                                    <h:outputText value="#{guestbook.usageCount} " />
                                </p:column>
                                <p:column width="40%" headerText="Action">

                                    <h:outputLink styleClass="btn btn-default" style="color:black;margin-right:0.5em;" rendered="false"
                                                  value="/guestbook.xhtml?id=#{guestbook.id}&#38;ownerId=#{guestbook.dataverse.id}">
                                        <h:outputText value="View"/>
                                    </h:outputLink>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="View" 
                                                   action="#{manageGuestbooksPage.viewSelectedGuestbook(guestbook)}"
                                                   oncomplete="viewGuestbook.show()"
                                                   update=":manageGuestbooksForm"
                                                   style="color:black;margin-right:0.5em;"/>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="Copy"                                                 
                                                   action="#{manageGuestbooksPage.cloneGuestbook(guestbook)}"
                                                   update="@form"
                                                   style="color:black;margin-right:0.5em;"/>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="Enable"  
                                                   rendered="#{manageGuestbooksPage.dataverse.id eq guestbook.dataverse.id and !guestbook.enabled}"
                                                   action="#{manageGuestbooksPage.enableGuestbook(guestbook)}"
                                                   update="@form,:messagePanel"
                                                   style="color:black;margin-right:0.5em;"/>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="Disable"  
                                                   rendered="#{manageGuestbooksPage.dataverse.id eq guestbook.dataverse.id and guestbook.enabled}"
                                                   action="#{manageGuestbooksPage.disableGuestbook(guestbook)}"
                                                   update="@form,:messagePanel"
                                                   style="color:black;margin-right:0.5em;"/>
                                    <h:outputLink styleClass="btn btn-default" style="color:black;margin-right:0.5em;" 
                                                  rendered="#{manageGuestbooksPage.dataverse.id eq guestbook.dataverse.id}"
                                                  value="/guestbook.xhtml?id=#{guestbook.id}&#38;ownerId=#{manageGuestbooksPage.dataverse.id}&#38;editMode=METADATA">
                                        <h:outputText value="Edit"/>
                                    </h:outputLink>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="View collected data" 
                                                   action="#{manageGuestbooksPage.viewSelectedGuestbookResponses(guestbook)}"
                                                   oncomplete="viewGuestbookResponse.show()"
                                                   update=":manageGuestbooksForm"
                                                   style="color:black;margin-right:0.5em;"/>
                                    <p:commandLink styleClass="btn btn-default" 
                                                   value="Delete" 
                                                   action="#{manageGuestbooksPage.setSelectedGuestbook(guestbook)}"
                                                   rendered="#{manageGuestbooksPage.dataverse.id eq guestbook.dataverse.id and guestbook.deletable}"
                                                   oncomplete="deleteConfirmation.show()"
                                                   style="color:black;margin-right:0.5em;"/>
                                </p:column>
                            </p:dataTable>
                        </ui:fragment>
                    </div>

                    <p:confirmDialog message="Are you sure you want to delete this guestbook? This action may not be 'Undone'." header="Delete Guestbook" widgetVar="deleteConfirmation">
                        <p:commandButton value="Continue" onclick="deleteConfirmation.hide()" action="#{manageGuestbooksPage.deleteGuestbook()}" update="@all">
                        </p:commandButton>
                        <p:commandButton value="Cancel" onclick="deleteConfirmation.hide()" type="button" />
                    </p:confirmDialog>
                    <p:dialog id="viewGuestbook" header="Dataset Guestbook Preview" widgetVar="viewGuestbook" width="600px" height="600px" style="overflow-y: scroll;">
                        <div class="form-horizontal">

                            <div class="form-group">
                                <label for="select_DatasetTemplate" class="col-sm-3 control-label">
                                    <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="Upon downloading files the guestbook asks for the following information .">Dataset Guestbook</a>
                                </label>
                                <div class="col-sm-7" style="padding-top: 7px;">
                                    #{manageGuestbooksPage.selectedGuestbook.name}
                                </div>
                            </div>
                        </div>
                        <div  style="padding-top: 7px;">
                        <h:outputText value="#{manageGuestbooksPage.selectedGuestbook.requiredAccountInformationString}" 
                                      rendered="#{!empty manageGuestbooksPage.selectedGuestbook.requiredAccountInformationString }"/>
                        </div>
                        <div style="padding-top: 7px;">
                        <h:outputText value="#{manageGuestbooksPage.selectedGuestbook.optionalAccountInformationString}" 
                                      rendered="#{!empty manageGuestbooksPage.selectedGuestbook.optionalAccountInformationString }"/>
                        </div>
                       <div style="padding-top: 7px;">
                        <h:outputText value="#{manageGuestbooksPage.selectedGuestbook.requiredCustomQuestionsString}" 
                                      rendered="#{!empty manageGuestbooksPage.selectedGuestbook.requiredCustomQuestionsString }"/>
                        </div>
                        <div style="padding-top: 7px;">
                        <h:outputText value="#{manageGuestbooksPage.selectedGuestbook.optionalCustomQuestionsString}" 
                                      rendered="#{!empty manageGuestbooksPage.selectedGuestbook.optionalCustomQuestionsString }"/>
                        </div>
                    </p:dialog>
                    
                    <p:dialog id="viewGuestbookResponse" header="Dataset Guestbook Reponses" widgetVar="viewGuestbookResponse" width="600px" height="600px" style="overflow-y: scroll;">
                        <div class="form-horizontal">

                            <div class="form-group">
                                <label for="select_DatasetTemplate" class="col-sm-3 control-label">
                                    <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="Upon downloading files the guestbook asks for the following information .">Dataset Guestbook</a>
                                </label>
                                <div class="col-sm-7" style="padding-top: 7px;">
                                    #{manageGuestbooksPage.selectedGuestbook.name}
                                </div>
                            </div>
                        </div>
                        <ui:repeat value="#{manageGuestbooksPage.responses}" var="response">
                        <div style="padding-top: 7px;">
                            <h:outputText value="#{response.dataset.releasedVersion.title}"/>
                        </div>
                            <h:outputText value="#{response.dataFile.displayName}"/>
                            <h:outputText value="#{response.name}"/>
                        </ui:repeat>

                    </p:dialog>                    

                </h:form>
            </ui:define>
        </ui:composition>

    </h:body>
</html>

