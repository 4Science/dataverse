<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:c="http://java.sun.com/jsp/jstl/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:o="http://omnifaces.org/ui"
     xmlns:jsf="http://xmlns.jcp.org/jsf">
         
      <script src="#{resource['js/handlebars-v3.0.3.js']}?version=#{systemConfig.getVersion()}"></script>
      <ui:include src="mydata_pager_template.xhtml"></ui:include>
    <script>

    Handlebars.registerHelper('isSelectedPage', function(lvalue, rvalue, options) {
        //console.log("lvalue:" + lvalue + ":" + rvalue);
        if( lvalue!=rvalue ) {
            return options.inverse(this);
        } else {
            return options.fn(this);
        }
    });
    //Handlebars.registerHelper('ifSelectedPage', function(pgNum, selectedPage, options) {

    //      return 'blah';
    //});
    /*
     * Example of pager_info:
     * no results: {"isNecessary":false}
     * results: {"isNecessary":true,"docsPerPage":10,"pageCount":12,"startCardNumber":21,"previousPageNumber":2,"selectedPageNumber":3,"numResults":111,"endCardNumber":30,"nextPageNumber":4,"pageNumberList":[1,2,3,4,5,6,7,8,9,10,11,12]} 
     */
    function makePager(pager_info){

        if (!pager_info.isNecessary){
            $("#pagination").html('(no pager)');
            return;
        }else{
            var source   = $("#pager-template").html();
            var template = Handlebars.compile(source);
            //var context = {title: "My New Post", body: "This is my first post!"};
            var pagination_html    = template(pager_info);
            $("#pagination").html(pagination_html);
            // alert(pager_info.pageCount);
            bindPages();
        }

    }

    function updatePager(newPage){
         $.getJSON( "/api/mydata/test-it2?selectedPage=" + newPage, function(data) {
               //alert(data);
               makePager(data);
               $("#divPagerJSON").html('<pre>' + JSON.stringify(data) + '</pre>');
            });
    }

    function bindPages(){
        $("a.page_link").click(function(evt) {
            console.log('script tag');

            evt.preventDefault(); // stop link from using href
            var page_num = $(this).attr('rel');
            updatePager(page_num);
            //alert(page_num);
             // alert(get_link(variable_name));
        });
    }

    $(document).ready(function() {
            //var json_info = <h:outputText value="#{RolePermissionHelperPage.pager.asJSONString()}" escape="false" />;
            var json_info = <h:outputText value="#{RolePermissionHelperPage.getRandomPagerJSON()}" escape="false" />;

           $.getJSON( "/api/mydata/test-it2", function(data) {
               //alert(data);
               makePager(data);
               $("#divPagerJSON").html('<pre>' + JSON.stringify(data) + '</pre>');
            });


            //makePager(json_info);
            //$("#divPagerJSON").html('<pre>' + JSON.stringify(json_info) + '</pre>');
    });
    </script>
              
</ui:composition>