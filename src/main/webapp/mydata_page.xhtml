<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

  <h:head>

  </h:head>

  <h:body>
    <ui:composition template="/dataverse_template.xhtml">
      <ui:param name="pageTitle" value="Role/Permission Relationships - #{dataverseServiceBean.findRootDataverse().name} #{bundle.dataverse}"/>
      <ui:param name="showDataverseHeader" value="false"/>
      <ui:define name="body">
          <f:metadata>
                <ui:remove>
                    <f:viewParam name="id" value="#{DatasetPage.dataset.id}"/>
                    <f:viewParam name="ownerId" value="#{DatasetPage.ownerId}"/>
                    <f:viewParam name="version" value="#{DatasetPage.version}"/>
                    <f:viewParam name="versionId" value="#{DatasetPage.versionId}"/>
                    <f:viewParam name="persistentId" value="#{DatasetPage.persistentId}"/>
                </ui:remove>
                    <f:viewAction action="#{MyDataPage.init}" />
          </f:metadata>

    <!-- start: row -->
    <div class="row">
        <!-- start filter column -->
        <div class="col-md-3">
            <form id="mydata_filter_form" name="mydata_filter_form">
            <div>
    <!--label for="exampleInputEmail1">Email address</label-->
            <input type="text" class="form-control" name="mydata_search_term" id="mydata_search_term" placeholder="Search" />
            <input type="hidden" name="selected_page" id="selected_page" value="1" />
            <input type="text" name="userIdentifier" id="userIdentifier" value="dataverseAdmin" />
            </div>
            <hr />            
                       

            <!-- start dvobject checkboxes -->
            <div id="div_dvobject_types" style="font-size:110%;font-weight:bold;">
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_dataverse" type="checkbox" value="Dataverse" checked="checked" />
                    <i class="icon-dataverse text-icon-inline"></i>
                    <span class="facetTypeDataverse">Dataverses <span id="idDataverseCount">(58,270)</span></span>
                </label></div>
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_dataset" type="checkbox" value="Dataset" checked="checked" />
                    <i class="icon-dataset text-icon-inline"></i>
                    <span class="facetTypeDataset">Datasets <span id="idDatasetCount">(58,270)</span></span>
                </label></div>
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_file" type="checkbox" value="DataFile" />
                    <i class="icon-file text-icon-inline"></i>
                        <span class="facetTypeFile">Files <span id="idFileCount">(58,270)</span></span>
                </label></div>
            </div>
            <!-- end dvobject checkboxes -->
            <!-- start: publish states -->
            <b>Publication Status</b>
            <div id="div_published_states">
                <ui:repeat value="#{MyDataPage.publishedStates}" var="pstate">
                    <div class="checkbox"><label>
                        <input name="published_states" id="id_cbox_#{pstate.toLowerCase()}" type="checkbox" value="#{pstate}" checked="checked"  />
                        #{pstate}
                    </label></div>                
                </ui:repeat>
            </div>
            <!-- end: publish states -->
            <!-- start: role states -->
            <b>Roles</b>
            <div id="div_role_states">
            <ui:repeat value="#{MyDataPage.roleInfoForCheckboxes}" var="roleInfoList">
                <div class="checkbox"><label>
                    <input name="role_ids" id="id_cbox_#{roleInfoList[1].toLowerCase()}" type="checkbox" value="#{roleInfoList[0]}" checked="checked" />
                    #{roleInfoList[1]}
                </label></div>    
            </ui:repeat>
            </div>
           <!-- end: role states -->
             </form>
            <b>parms sent</b>
            <div id="div-search-params" class="well"></div>
        </div><!-- end: filter column -->
        <!-- start: workspace column -->
        <div class="col-md-9">
            <div id="div-pagination">(pagination)</div>
            <!--<div id="div-test-json" class="well">(pagination)</div>-->

            <hr />
            <div id="div-result-message">workspace</div>
            <div id="div-card-results">(card results?)</div>
            <div id="div-more-cards-link" class="text-center" style="display:none;">
                <a id="lnk_add_more_cards" href="javascript:search_add_more_cards();" class="btn btn-primary btn-xs">View more results</a>
            </div> 
            
            
            <div id="div-json-results">workspace</div>
        </div>
        <!-- end: workspace column -->
                <!--
                <li><label for="id_dvobject_types_0"><input checked="checked" id="id_dvobject_types_0" name="dvobject_types" type="checkbox" value="dataverses" /> Dataverses</label></li>
                <li><label for="id_dvobject_types_1"><input checked="checked" id="id_dvobject_types_1" name="dvobject_types" type="checkbox" value="datasets" /> Datasets</label></li>
                <li><label for="id_dvobject_types_2"><input checked="checked" id="id_dvobject_types_2" name="dvobject_types" type="checkbox" value="files" /> Files</label></li>
                -->
    </div><!-- end row -->
    <script src="#{resource['js/nunjucks.js']}?version=#{systemConfig.getVersion()}"></script>
    <script src="#{resource['js/mydata.js']}?version=#{systemConfig.getVersion()}"></script>
    <script>
            <ui:fragment rendered="#{MyDataPage.hasFilterParams()}">
            dtype_info =  <h:outputText value="#{MyDataPage.getFilterParams().dvObjectTypesAsJSONString}" escape="false" />;                        
            </ui:fragment>
           
          
          $(document).ready(function() {
              $('#div-more-cards-link').hide();
             // var env = new nunjucks.Environment(new nunjucks.WebLoader('/mydata_templates'), true);
              //nunjucks.configure({ autoescape: true });
              
              // Capture checkbox clicks
              //
              $('input:checkbox').on('click',function(){ 
                  //var checkedId=$(this,'input').attr('id');
                  //alert(checkedId);
                  $("#selected_page").val('1');
                  regular_search();
              });
              
              // Capture pressing return in search box
              $('#mydata_search_term').keypress(function(e) {
                if (e.which == '13') {
                    $("#selected_page").val('1');
                    regular_search();
                }
              });
              
              $( "#mydata_filter_form" ).submit(function( event ) {
                //alert( "Handler for .submit() called." );
                event.preventDefault();
                $("#selected_page").val('1');
                regular_search();

              });
              
              regular_search(); // run initial search
              //var selected = [];
              //$('#checkboxes input:checked').each(function() {
              //  selected.push($(this).attr('name'));
              //});
           });
    </script>
</ui:define>
    </ui:composition>
  </h:body>
</html>
