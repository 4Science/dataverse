<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

  <h:head>

  </h:head>

  <h:body>
    <ui:composition template="/dataverse_template.xhtml">
      <ui:param name="pageTitle" value="Role/Permission Relationships - #{dataverseServiceBean.findRootDataverse().name} #{bundle.dataverse}"/>
      <ui:param name="showDataverseHeader" value="false"/>
      <ui:define name="body">
          <f:metadata>
                <ui:remove>
                    <f:viewParam name="id" value="#{DatasetPage.dataset.id}"/>
                    <f:viewParam name="ownerId" value="#{DatasetPage.ownerId}"/>
                    <f:viewParam name="version" value="#{DatasetPage.version}"/>
                    <f:viewParam name="versionId" value="#{DatasetPage.versionId}"/>
                    <f:viewParam name="persistentId" value="#{DatasetPage.persistentId}"/>
                </ui:remove>
                    <f:viewAction action="#{MyDataPage.init}" />
          </f:metadata>

    <!-- start: row -->
    <div class="row">
        <!-- start filter column -->
        <div class="col-md-3">
            <form id="mydata_filter_form" name="mydata_filter_form">
            <div>
    <!--label for="exampleInputEmail1">Email address</label-->
            <input type="text" class="form-control" name="mydata_q" id="mydata_q" placeholder="Search" />
            <input type="hidden" name="selected_page" id="selected_page" value="1" />
            </div>
            <hr />            
                       

            <!-- start dvobject checkboxes -->
            <div id="div_dvobject_types" style="font-size:110%;font-weight:bold;">
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_dataverse" type="checkbox" value="Dataverse" checked="checked" />
                    <i class="icon-dataverse text-icon-inline"></i>
                    <span class="facetTypeDataverse">Dataverses <span id="idDataverseCount">(58,270)</span></span>
                </label></div>
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_dataset" type="checkbox" value="Dataset" checked="checked" />
                    <i class="icon-dataset text-icon-inline"></i>
                    <span class="facetTypeDataset">Datasets <span id="idDatasetCount">(58,270)</span></span>
                </label></div>
                <div class="checkbox"><label>
                    <input name="dvobject_types" id="id_cbox_dv_file" type="checkbox" value="DataFile" />
                    <i class="icon-file text-icon-inline"></i>
                        <span class="facetTypeFile">Files <span id="idFileCount">(58,270)</span></span>
                </label></div>
            </div>
            <!-- end dvobject checkboxes -->
            <!-- start: publish states -->
            <b>Publication Status</b>
            <div id="div_published_states">
                <ui:repeat value="#{MyDataPage.publishedStates}" var="pstate">
                    <div class="checkbox"><label>
                        <input name="published_states" id="id_cbox_#{pstate.toLowerCase()}" type="checkbox" value="#{pstate}" checked="checked"  />
                        #{pstate}
                    </label></div>                
                </ui:repeat>
            </div>
            <!-- end: publish states -->
            <!-- start: role states -->
            <b>Roles</b>
            <div id="div_role_states">
            <ui:repeat value="#{MyDataPage.roleInfoForCheckboxes}" var="roleInfoList">
                <div class="checkbox"><label>
                    <input name="role_id" id="id_cbox_#{roleInfoList[1].toLowerCase()}" type="checkbox" value="#{roleInfoList[0]}" checked="checked" />
                    #{roleInfoList[1]}
                </label></div>    
            </ui:repeat>
            </div>
           <!-- end: role states -->
             </form>
            <b>parms sent</b>
            <div id="div-search-params" class="well"></div>
        </div><!-- end: filter column -->
        <!-- start: workspace column -->
        <div class="col-md-9">
            <div id="div-paginatioon">(pagination)</div>
            <hr />
            <div id="div-result-message">workspace</div>
            <div id="div-json-results">workspace</div>
        </div>
        <!-- end: workspace column -->
                <!--
                <li><label for="id_dvobject_types_0"><input checked="checked" id="id_dvobject_types_0" name="dvobject_types" type="checkbox" value="dataverses" /> Dataverses</label></li>
                <li><label for="id_dvobject_types_1"><input checked="checked" id="id_dvobject_types_1" name="dvobject_types" type="checkbox" value="datasets" /> Datasets</label></li>
                <li><label for="id_dvobject_types_2"><input checked="checked" id="id_dvobject_types_2" name="dvobject_types" type="checkbox" value="files" /> Files</label></li>
                -->
    </div><!-- end row -->
    <script src="#{resource['js/nunjucks.js']}?version=#{systemConfig.getVersion()}"></script>
    <script>
            <ui:fragment rendered="#{MyDataPage.hasFilterParams()}">
            dtype_info =  <h:outputText value="#{MyDataPage.getFilterParams().dvObjectTypesAsJSONString}" escape="false" />;                        
            </ui:fragment>
    
    
            function bindPages(){
               console.log("bindpages");
               $("a.page_link").click(function(evt) {
                   evt.preventDefault(); // stop link from using href
                   var page_num = $(this).attr('rel');
                   $("#selected_page").val(page_num);  // update the selected page in the form
                   //console.log("bind: " + page_num);
                   submitMyDataSearch();    // run search
                   //alert(page_num);
                    // alert(get_link(variable_name));
               });
            }
            
            function submitMyDataSearch(){
                //alert();
                var formData = $('#mydata_filter_form').serialize();
                $("#div-search-params").html(formData);
                //alert(formData);
                //return;
                $.getJSON( "/api/mydata/initial?" + formData, function(data) {
                    //alert(JSON.stringify(data));
                    $("#div-json-results").html(JSON.stringify(data));
                    if (data.success){
                        // Render pager
                        if (data.data.hasOwnProperty('pagination')){
                            console.log('render pagination');
                            var pagination_json = data.data.pagination;
                            var pagination_html =  nunjucks.render('mydata_templates/mydata.html', pagination_json);
                            $("#div-paginatioon").html(pagination_html);
                            bindPages();
                        }
                        console.log('solr_docs?');
                        //if (data.data.items.hasOwnProperty('solr_docs"')){
                        console.log(data.data.items);
                        //}

                        if (data.hasOwnProperty('items"')){
                            console.log('items');
                        }
                        if (data.data.hasOwnProperty('items"')){
                            console.log('data.items');
                        }
                        //alert(JSON.stringify(pagination_json));
                    }else{
                        $('#div-result-message').html(data.error_message);
                        //alert('no');
                    }
            //alert(data);
            //makePager(data);
               //     $("#divPagerJSON").html('<pre>' + JSON.stringify(data) + '</pre>');
                });
            }
            
          
          $(document).ready(function() {
             // var env = new nunjucks.Environment(new nunjucks.WebLoader('/mydata_templates'), true);
              //nunjucks.configure({ autoescape: true });
              
              // Capture checkbox clicks
              //
              $('input:checkbox').on('click',function(){ 
                  //var checkedId=$(this,'input').attr('id');
                  //alert(checkedId);
                  submitMyDataSearch();
              });
              
              // Capture pressing return in search box
              $('#mydata_searchbox').keypress(function(e) {
                if (e.which == '13') {
                    submitMyDataSearch();
                }
              });
              
              $( "#mydata_filter_form" ).submit(function( event ) {
                //alert( "Handler for .submit() called." );
                event.preventDefault();
                submitMyDataSearch();

              });

              //var selected = [];
              //$('#checkboxes input:checked').each(function() {
              //  selected.push($(this).attr('name'));
              //});
           });
    </script>
</ui:define>
    </ui:composition>
  </h:body>
</html>
