<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:c="http://java.sun.com/jsp/jstl/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:o="http://omnifaces.org/ui"
     xmlns:jsf="http://xmlns.jcp.org/jsf">
         
<script src="#{resource['js/nunjucks.js']}?version=#{systemConfig.getVersion()}"></script>
<script>

    /*
     * Example of pager_info:
     * no results: {"isNecessary":false}
     * results: {"isNecessary":true,"docsPerPage":10,"pageCount":12,"startCardNumber":21,"previousPageNumber":2,"selectedPageNumber":3,"numResults":111,"endCardNumber":30,"nextPageNumber":4,"pageNumberList":[1,2,3,4,5,6,7,8,9,10,11,12]} 
     */
    function makePager(pager_info){

        if (!pager_info.isNecessary){
            $("#pagination").html('(no pager)');
            return;
        }else{
        //var ts = nunjucks.renderString('Hello {{ username }}', { username: 'James' });
            var pagination_html =  nunjucks.render('mydata_templates/mydata.html', pager_info);
            $("#pagination").html(pagination_html);
            $("#divPagerJSON").html('<pre>' + JSON.stringify(pager_info) + '</pre>');
            bindPages();
        }

    }

    function updatePager(newPage){
         $.getJSON( "/api/mydata/test-it2?selectedPage=" + newPage, function(data) {
            //alert(data);
            makePager(data);
            $("#divPagerJSON").html('<pre>' + JSON.stringify(data) + '</pre>');
        });
    }

    function bindPages(){
        console.log("bindpages");
        $("a.page_link").click(function(evt) {
            evt.preventDefault(); // stop link from using href
            var page_num = $(this).attr('rel');
            console.log("bind: " + page_num);
            updatePager(page_num);
            //alert(page_num);
             // alert(get_link(variable_name));
        });
    }
    
    function displayDocs(solrDocs){
        console.log(solrDocs);
        $("#solr_docs").html('clear solrDocs'); // clear existing docs
        

        var cards_html = '';
        // not sure why nunjucks template loop wasn't working before
        $.each( solrDocs.docs, function( index, doc ) {
            cards_html += nunjucks.render('mydata_templates/cards.html', doc);
        });
        $("#solr_docs").html(cards_html);
       //nunjucks.render('mydata_templates/cards.html', solrDocs);
       
       //var cards_html = nunjucks.render('mydata_templates/cards.html', solrDocs.docs[0]);
       //var cards2_html = nunjucks.render('mydata_templates/cards.html', solrDocs.docs[2]);
        //$("#solr_docs").html(cards_html + cards2_html);//cards_html);            
    }
    

    $(document).ready(function() {
        var env = new nunjucks.Environment(new nunjucks.WebLoader('/mydata_templates'), true);
        nunjucks.configure({ autoescape: true });
        
        //var json_info = <h:outputText value="#{RolePermissionHelperPage.pager.asJSONString()}" escape="false" />;
        var json_info = <h:outputText value="#{RolePermissionHelperPage.getRandomPagerJSON()}" escape="false" />;
        makePager(json_info);
        
        // experimenting
        var solrDocs = <h:outputText value="#{RolePermissionHelperPage.getSolrDocs()}" escape="false" />;
                        
        if (solrDocs.docs.length){
            //alert(solrDocs.docs.length);
            //alert(solrDocs.docs[0].description);
            displayDocs(solrDocs);
        }
         
    });
</script>

</ui:composition>